import tkinter as tk
import time
import random


class RoundedFrame(tk.Frame):
    def __init__(self, parent, bg='#ffffff', width=800, height=400, corner_radius=15, **kwargs):
        super().__init__(parent, bg=bg, **kwargs)
        self.corner_radius = corner_radius

        self.canvas = tk.Canvas(
            self, width=width, height=height, bg=bg, highlightthickness=0
        )
        self.canvas.pack(fill="both", expand=True)
        self.create_rounded_rect()

        self.inner_frame = tk.Frame(self, bg=bg)
        self.canvas.create_window(width // 2, height // 2, window=self.inner_frame)

    def create_rounded_rect(self):
        r = self.corner_radius
        w, h = self.canvas.winfo_reqwidth(), self.canvas.winfo_reqheight()
        self.canvas.create_arc((0, 0, r * 2, r * 2), start=90, extent=90, fill=self.cget("bg"), outline="")
        self.canvas.create_arc((w - r * 2, 0, w, r * 2), start=0, extent=90, fill=self.cget("bg"), outline="")
        self.canvas.create_arc((w - r * 2, h - r * 2, w, h), start=270, extent=90, fill=self.cget("bg"), outline="")
        self.canvas.create_arc((0, h - r * 2, r * 2, h), start=180, extent=90, fill=self.cget("bg"), outline="")
        self.canvas.create_rectangle(r, 0, w - r, h, fill=self.cget("bg"), outline="")
        self.canvas.create_rectangle(0, r, w, h - r, fill=self.cget("bg"), outline="")


import tkinter as tk
import time
import random

class TypingSpeedTest:
    def __init__(self, root):
        self.root = root
        self.root.title("Typing Speed Test")
        self.root.geometry("800x400")
        self.root.configure(bg='#f0f0f0')

        # Sample texts for typing practice
        self.texts = [
            "Ханс Кристиан Андерсен не мог грамотно написать практически ни одного слова.",
            "Самый большой динозавр из когда-либо обнаруженных достигал в длину более тридцати метров и весил более восьмидесяти тонн.",
            "Ночью Млечный путь выглядит как вытянутое туманное облако, состоящее из более чем двухсот миллиардов звёзд.",
            "З емля - единственная планета солнечной системы, которую не назвали в честь бога.",
            "Продолжительность первого выхода в космос Леоновым составила двенадцать минут.",
            "В молодости черноморские окуни в основном самки, но уже к пяти годам они радикально меняют пол.",
            "Во время второй мировой войны первая бомба, сброшенная на Берлин, убила единственного слона в Берлинском зоопарке.",
            "Почти тридцать процентов женщин, узнав, что выиграли в лотерею, прячут выигрышный билет в лифчик.",
            "С ноября тысяча девятьсот сорок первого года в Советском Союзе был налог на бездетность. Он составлял шесть процентов от всей зарплаты.",
            "В среднем одинокие мужчины на два с половиной сантиметра ниже ростом, чем женатые.",
            "Ежедневная двадцатиминутная прогулка сжигает около трех килограмм жира в год.",
            "В ходе массового опроса секретарш, проведенного американскими социальными психологами, девяносто два процента респонденток заявили, что они 'не прочь завести роман' со своим шефом.",
            "Автором электрического стула был простой дантист.",
            "Длина всех кровеносных сосудов человеческого тела — около девяносто шести тысяч километров.",
            "Ушная сера необходима для здоровья ушей.",
            "За всю историю регистрации температуры в России самой холодной зимой была зима тысяча семьсот сорокового года.",
            "Три самые богатые семьи в мире имеют больше активов, чем сорок восемь беднейших стран.",
            "Человек — единственное животное, которое плачет из-за эмоций.",
            "Во время полета в самолете скорость роста волос у человека удваивается.",
            "Одиннадцать процентов людей на земле левши.",
            "Люди теряют около шестиста тысяч частиц кожи каждый час.",
            "В городе Крескилл в Нью-Джерси все коты и кошки должны носить три колокольчика, чтобы птицы всегда знали об их расположении.",
            "За среднестатистическую жизнь сердце делает три миллиарда триста миллионов ударов.",
            "Тонкая кишка человека имеет длину порядка двух с половиной метров.",
            "Игрушка йо-йо появилась в шеснадцатом веке на Филиппинах в качестве оружия.",
            "Юлий Цезарь носил лавровый венок, чтобы скрыть начинающуюся лысину.",
            "Человеческий волос толще мыльной пленки примерно в пять тысяч раз.",
            "Луна легче Земли в восемьдесят раз.",
            "Вольфганг Моцарт, один раз прослушав в Ватикане многоголосое духовное сочинение Аллегри, за ночь записал точную копию произведения.",
            "Виноград взрывается в микроволновой печи.",
            "В городе Тегази в Сахаре встречаются дома со стенами из каменной соли. Это одно из самых сухих мест на Земле.",
            "В Англии наезд на собаку наказывается строже, чем наезд на человека.",
            "До 18-ого века у России не было флага.",
            "Древние египтяне использовали тени для глаз, чтобы уберечься от конъюнктивита и трахомы.",
            "После того как Александр Македонский завез из одного своего индийского похода в Грецию тростниковый сахар, его сразу же начали называть “индийской солью”.",
            "У блондинов больше волос.",
            "Египетские пирамиды были такими же древними для жителей Древнего Рима, как для нас сегодня, сама Римская Империя.",
            "На создание песни «Я морж» Джона Леннона вдохновили звуки полицейской сирены.",
            "Кость в пять раз прочнее стали.",
            "Парасомния — термин, обозначающий неестественные движения во время сна. Некоторые люди даже совершали преступление из-за парасомнии, включая вождение во сне и даже убийство.",
            "У жирафа и человека одинаковое количество шейных позвонков.",
            "В среднем человек за всю жизнь тратит на поцелуи 2 недели.",
            "Самая опасная работа в США – ловля крабов на Аляске.",
            "Великий Леонардо да Винчи является создателем ножниц.",
            "До того, как получить название «Лондон», британская столица успела побыть Лондониумом, Люденвиком и Люденбургом.",
            "Библия – книга, которую чаще всего воруют в американских магазинах.",
            "Последнее извержение японского вулкана Фудзияма произошло в 1707 году.",
            "Глаза у осла размещены таким образом, что в поле его зрения всегда находятся все 4 ноги.",
            "В 1991 году в Канаде на бетонном постаменте был установлен памятник топору. Вес монумента составил 7 тонн.",
            "В среднем люди самого маленького роста – японцы.",
            "Ежедневно жители США съедают 18 гектаров пиццы.",
            "В 1811 и 1812 годах три землетрясения, измеряющие приблизительно в 8 баллов по шкале Рихтера, заставил реку Миссисипи течь назад.",
            "Рисунок поверхности носа кошки уникален, как отпечаток пальца у человека.",
            "Улитки могут спать три года, не употребляя никакой пищи.",
            "Человек по имени Чарльз Осборн безостановочно икал шестьдесят девять лет.",
            "Когда под китайским городом Таншань сдвинулись литосферные плиты, 90% его зданий рухнуло за несколько секунд.",
            "Самым высоким деревом в мире был австралийский эвкалипт. Его высота, зафиксированная в 1872 году, была 132 метра.",
            "В Великобритании нет единого документа конституции.",
            "Гравитационное притяжение Солнца настолько сильно, что даже Плутон, который находится на расстоянии 5 900 000 000 километров от него, все еще остается на его орбите.",
            "Если у одного из однояйцевых близнецов не хватает того или иного зуба, как правило, такой же зуб отсутствует и у другого близнеца.",
            "Национальный гимн Греции имеет 158 куплетов.",
            "В ЮАР самый высокий показатель нападений, изнасилований и убийств с применением огнестрельного оружия в мире.",
            "Из двух миллиардов человек, только одному удается дожить до 116 лет.",
            "Солнечный свет достигает Земли за 8 минут, Юпитера — за 40 минут, а чтобы достигнуть границ Солнечной системы, ему требуется 7 часов.",
            "В Антарктиде существует единственная река – Оникс, она течет всего 60 дней в году?",
            "Каждые 27 дней Вы буквально меняете кожу.",
            "Упавший на спину баран не сможет перевернуться.",
            "Кашель - взрывной заряд воздуха, который движется со скоростью до 60 миль/ч.",
            "Хищные животные не поедают других животных, пораженных ударом молнии?",
            "Поют только соловьи-самцы, выражая тем самым преданность и любовь своей подруге, которая, как правило, сидит где-нибудь поблизости, не подавая голоса.",
            "Дети, которых вскармливают грудью, вырастают более худыми по сравнению с теми, кто рос на искусственном питании.",
            "Мозг неандертальца был больше, чем у нас с вами.",
            "В Гамбурге есть детский сад для мужчин?",
            "Человеческий организм производит и убивает 15 миллионов красных кровяных телец в секунду.",
            "Воинская честь ни в одной стране не отдается левой рукой.",
            "Для работы мозгу требуется столько же энергии, сколько 10-ваттной лампочке.",
            "У израильского царя Соломона было около 700 жен и еще 300 наложниц?",
            "Самая короткая война в истории – между Англией и Занзибаром, продолжалась всего 38 минут.",
            "Без головы таракан может жить еще 2 недели!",
            "Жирафу нужно всего 2 часа сна в день, тогда как коричневой летучей мыши - 20 часов в день.",
            "Мужское сердце бьется медленнее, чем женское?",
            "Крыса может упасть с пятиэтажного здания без каких-либо повреждений.",
            "Волос человека практически не поддается разрушению.",
            "Каждый год Солнце «теряет» 360 миллионов тонн.",
            "Великий Леонардо да Винчи покупал на рынке животных в клетках, чтобы отпускать из на свободу?",
            "Футбольный стадион Уэмбли в Англии создан только для игр, тренировки на нем запрещены.",
            "Самое короткое расстояние от России до Америки — 4 км.",
            "Однажды профессору-физику Джеку Хезерингтону сообщили, что он не может быть указан единственным автором своей научной работы, так как в ней употребляются слова «мы» и «наш». Тогда он решил не переписывать работу, а добавил в соавторы своего кота.",
            "Первым продуктом, имевшим штрих-код, была жвачка Wrigley?",
            "Аляска — Самый северный, Восточный, И Западный штат во всей Америке. Это также единственная часть континента, входящая в восточное полушарие.",
            "Синий кит - самое крупное млекопитающее, весящее столько же, сколько 23 слона.",
            "Температура крови у рыб Антарктиды может достигать -1,7 градусов Цельсия.",
            "Нервный импульс из мозга движется со скоростью 274 км/ч?",
            "Китайский язык является самым популярным в мире.",
            "Персонаж Дональд Дак был запрещен в Финляндии, потому что он не носит брюки.",
            "Желудку нужно производить новый слой слизи каждые 2 недели, иначе желудок переварит сам себя.",
            "Испания значит «земля кроликов»?",
            "Одним из древнейших насекомых нашей планеты является обычная муха, возраст найденных окаменелых останков которой оценивается учеными в миллионы и миллионы лет.",
            "Глаз страуса больше, чем его мозг.",
            "Белокурые бороды растут быстрее, чем темные.",
        ]

        self.current_text = ""
        self.start_time = 0
        self.test_started = False
        self.typed_index = 0
        self.error_index = -1

        # Create main frame
        self.main_frame = tk.Frame(root, bg='white')
        self.main_frame.pack(fill="both", expand=True, padx=20, pady=20)

        # Create and pack widgets
        self.create_widgets()

    def create_widgets(self):
        # Instructions
        self.instructions = tk.Label(
            self.main_frame,
            text="Click 'Start' to begin the typing test.",
            font=("Arial", 12),
            bg='white'
        )
        self.instructions.pack(pady=10)

        # Text display
        self.text_display = tk.Text(
            self.main_frame,
            font=("Arial", 14),
            bg="white",
            fg="#cccccc",
            wrap="word",
            state="disabled",
            borderwidth=0,
            highlightthickness=0,
            padx=10,
            pady=10
        )
        self.text_display.pack(fill="both", expand=True, padx=10, pady=10)

        # Start button
        self.start_button = tk.Button(
            self.main_frame,
            text="Start",
            command=self.start_test,
            font=("Arial", 12),
            bg='#4CAF50',
            fg='white',
            relief='flat',
            padx=20
        )
        self.start_button.place(x=370, y=330)  # Button placed over the screen initially

    def start_test(self):
        self.current_text = random.choice(self.texts)
        self.typed_index = 0
        self.error_index = -1
        self.test_started = True
        self.start_time = time.time()
        self.start_button.config(state='disabled')

        # Display the text
        self.text_display.config(state="normal", fg="#cccccc")
        self.text_display.delete("1.0", "end")
        self.text_display.insert("1.0", self.current_text)
        self.text_display.tag_configure("default", foreground="#cccccc")
        self.text_display.tag_configure("correct", foreground="green")
        self.text_display.tag_configure("error", foreground="red")
        self.text_display.tag_add("default", "1.0", "end")
        self.text_display.config(state="disabled")

        # Bind keypress events
        self.root.bind("<Key>", self.check_input)

    def check_input(self, event):
        if not self.test_started or not event.char or len(event.char) != 1:
            return

        if self.error_index == -1:  # No error yet
            if event.char == self.current_text[self.typed_index]:
                self.typed_index += 1
                self.update_display()
                if self.typed_index == len(self.current_text):
                    self.show_results()
            else:
                self.error_index = self.typed_index
                self.update_display(error=True)
        else:  # Error state (continuing to correct and type)
            if event.keysym == "BackSpace":
                self.error_index = max(self.error_index - 1, -1)
                self.update_display()
            elif event.char == self.current_text[self.typed_index]:
                self.typed_index += 1
                self.error_index = -1  # Error fixed, continue typing
                self.update_display()

    def update_display(self, error=False):
        self.text_display.config(state="normal")
        self.text_display.tag_remove("correct", "1.0", "end")
        self.text_display.tag_remove("error", "1.0", "end")
        self.text_display.tag_remove("default", "1.0", "end")

        # Обработка отображения текста с выделением
        if error:
            # Подсвечиваем правильно введенные символы зеленым
            self.text_display.tag_add("correct", "1.0", f"1.{self.typed_index}")
            # Подсвечиваем ошибочный символ красным
            self.text_display.tag_add("error", f"1.{self.typed_index}", f"1.{self.error_index + 1}")
            # Подсвечиваем оставшийся текст серым
            self.text_display.tag_add("default", f"1.{self.error_index + 1}", "end")
        else:
            # Подсвечиваем весь правильный текст
            self.text_display.tag_add("correct", "1.0", f"1.{self.typed_index}")
            # Подсвечиваем оставшийся текст серым
            self.text_display.tag_add("default", f"1.{self.typed_index}", "end")

        self.text_display.config(state="disabled")


    def show_results(self):
        self.test_started = False
        self.root.unbind("<Key>")

        elapsed_time = time.time() - self.start_time
        words = len(self.current_text.split())
        wpm = round((words / elapsed_time) * 60)
        cpm = round((len(self.current_text) / elapsed_time) * 60)

        result_text = f"Time: {elapsed_time:.2f} seconds\n"
        result_text += f"Speed: {wpm} words per minute\n"
        result_text += f"Characters per minute: {cpm}"

        self.text_display.config(state="normal", fg="#000000")
        self.text_display.delete("1.0", "end")
        self.text_display.insert("1.0", result_text)
        self.text_display.config(state="disabled")
        self.start_button.config(state="normal")


def main():
    root = tk.Tk()
    TypingSpeedTest(root)
    root.mainloop()


if __name__ == "__main__":
    main()
